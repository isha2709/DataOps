# Sample YAML file to validate and export an ARM template into a build artifact
# Requires a package.json file located in the target repository

trigger:
- master

pool:
  vmImage: 'windows-latest'

# variables:
#   - group: DataOpsUAT
  
steps:

- powershell: dir $(Build.SourcesDirectory) -recurse

- task: UsePythonVersion@0
  displayName: Configuring Python Version
  inputs:
    versionSpec: '3.x'
    addToPath: true
    architecture: 'x64'

- powershell: |
    Write-Output "[DEFAULT]" | Out-File ~\.databrickscfg -Encoding ASCII
    Write-Output "host = $(databricks.host)" | Out-File ~\.databrickscfg -Encoding ASCII -Append
    Write-Output "token = $(databricks.token)" | Out-File ~\.databrickscfg -Encoding ASCII -Append

# - bash: |
#     pip3 install --upgrade databricks-cli

#     databricks configure --token <<EOF
#     $(databricks.host)
#     $(databricks.token)
#     EOF
#     echo -e "\nDatabricks workspace list:"
#     databricks workspace list

- powershell: |
    databricks workspace list --profile AZDO
    databricks workspace import_dir -o --profile AZDO $(Build.SourcesDirectory)/databricks/ /demo
